<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/static/styles.css">
<title>Reporte de Ventas</title>
<!-- Incluimos Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
            .date-selector {
            margin-bottom: 20px;
        }

        .date-selector label {
            margin-right: 10px;
            font-weight: bold;
        }

        .date-selector input[type="date"] {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .generate-report-btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: #4caf83;
            color: white;
            text-decoration: none;
            margin-top: 10px;
            font-size: 14px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: auto; /* Ajusta el ancho al contenido */
        }

        .generate-report-btn:hover {
            background-color: #388e3c;
        }
    /* Estilos para el contenedor principal */
    .admin-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
        padding: 20px;
    }

    /* Contenedor flexible para los elementos de datos y gráficas */
    .datos-graficas-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }

    /* Estilos para los contenedores individuales */
    .categorias-container,
    .grafico-container,
    .ganancias-container,
    .ventas-metodo-container,
    .grafica-ventas-container,
    .ventas-actual-container {
        background-color: white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        padding: 20px;
    }

    /* Agrupación de elementos en filas para pantallas grandes */
    .fila {
        display: flex;
        gap: 20px;
        width: 100%;
    }

    .fila > div {
        flex: 1;
        min-width: 0; /* Permite que los elementos se reduzcan más allá de su contenido mínimo */
    }

    /* Ajustes para el gráfico circular y la tabla de ganancias */
    .grafico-container canvas,
    .ganancias-container table {
        width: 100%;
        height: auto;
    }

    /* Estilos para títulos de sección */
    h3 {
        margin-top: 0;
        color: #333;
        border-bottom: 2px solid #4caf83;
        padding-bottom: 10px;
    }

    /* Estilos para tablas */
    table {
        width: 100%;
        border-collapse: collapse;
    }

    th, td {
        padding: 8px;
        text-align: left;
    }

    th {
        background-color: #f2f2f2;
    }

    /* Responsive design */
    @media screen and (max-width: 1024px) {
        .fila {
            flex-direction: column;
        }

        .fila > div {
            width: 100%;
        }
    }

    @media screen and (max-width: 768px) {
        .datos-graficas-container {
            flex-direction: column;
        }

        .datos-graficas-container > div,
        .fila > div {
            width: 100%;
        }
    }


    .ventas-datos-grafica {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }

    .ventas-datos-grafica > table,
    .ventas-datos-grafica > .grafica-container {
        flex: 1;
        min-width: 300px;
        max-width: 600px;
    }

    .grafica-container {
        max-width: 600px;
        margin: auto;
    }

    .ventas-dia-container {
        margin-top: 20px;
    }

    .grafico-y-ventas-actual {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }

    .grafico-container,
    .ventas-actual-container {
        flex: 1;
        min-width: 300px;
        max-width: 600px;
    }
    .reporte-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .reporte-header h1 {
      font-size: 2rem;
      color: #333;
    }
</style>
</head>
<body>
    <button class="toggle-sidebar" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>
<!-- Sidebar -->
{% include 'sidebar.html' %}
<!-- Contenido Principal -->
<div class="main-content">
    <div class="reporte-header">
        <h1>Reporte de ventas</h1>
        <div class="date-selector">
            <label for="start-date">Desde:</label>
            <input type="date" id="start-date" name="start-date">
            
            <label for="end-date">Hasta:</label>
            <input type="date" id="end-date" name="end-date">
            
            <button class="generate-report-btn" id="generate-report-btn">Generar Reporte</button>
        </div>

    </div>

    <div class="admin-container">
        <!-- Categorías Más Vendidas con Gráfico Circular -->
        <div class="fila">
            <div class="categorias-container">
                <h3>Categorías Más Vendidas</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Categoría</th>
                            <th>Ingresos brutos</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if categorias_vendidas %}
                        {% for categoria in categorias_vendidas|sort(attribute='ingresos_brutos', reverse=True) %}
                        <tr>
                            <td>{{ categoria.categoria }}</td>
                            <td>{{ categoria.ingresos_brutos }}</td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td>No hay datos disponibles</td>
                            <td>No hay datos disponibless</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
            <div class="grafico-container">
                <canvas id="categoriasChart"></canvas>
            </div>
        </div>

        <!-- Ganancias por Categoría -->
        <div class="ganancias-container">
            <h3>Ganancias por Categoría</h3>
            <table>
                <thead>
                    <tr>
                        <th>Categoría</th>
                        <th>Ganancia</th>
                    </tr>
                </thead>
                <tbody>
                    {% if ganancias_categoria %}
                    {% for ganancia in ganancias_categoria %}
                    <tr>
                        <td>{{ ganancia.categoria }}</td>
                        <td>{{ ganancia.ganancia_total }}</td>
                    </tr>
                    {% endfor %}
                    {% else %}
                    <tr>
                        <td>No hay datos disponibles</td>
                        <td>No hay datos disponibless</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <!-- Ventas por Método de Pago con Gráfico Circular -->
        <div class="fila">
            <div class="categorias-container">
                <h3>Ventas por Método de Pago</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Método de Pago</th>
                            <th>Ganancias</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if ventas_metodo_pago %}
                        {% for metodo in ventas_metodo_pago %}
                        <tr>
                            <td>{{ metodo.metodo_pago }}</td>
                            <td>{{ metodo.ganancia_total }}</td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td>No hay datos disponibles</td>
                            <td>No hay datos disponibless</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
            <div class="grafico-container">
                <canvas id="metodoPagoChart"></canvas>
            </div>
        </div>

        <!-- Ventas por Día con Gráfico de Barras -->
        <div class="ventas-dia-container">
            <h3>Ventas por Día</h3>
            <div class="grafico-y-ventas-actual">
                <div class="grafico-container">
                    <canvas id="ventasDiaChart"></canvas>
                </div>
                <div class="ventas-actual-container">
                    <h3>Ventas del Día Actual</h3>
                    <p><strong>Total de Ventas:</strong> <span id="totalVentas">{{ ventas_dia }}</span></p>
                    <p><strong>Ganancias Totales:</strong> <span id="gananciasTotales">{{ ganancias_dia }}</span></p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Script para generar los gráficos -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('generate-report-btn').addEventListener('click', async () => {
        const fecha_inicio = document.getElementById('start-date').value.trim();
        const fecha_fin = document.getElementById('end-date').value.trim();
        console.log("fecha inicio: " + fecha_inicio);
        console.log("fecha fin: " + fecha_fin);
    });
});


    // Función para alternar el sidebar (similar a la utilizada en otras páginas)
    function toggleSidebar() {
      const sidebar = document.querySelector('.sidebar');
      const mainContent = document.querySelector('.main-content');
      const toggleButton = document.querySelector('.toggle-sidebar');
      
      sidebar.classList.toggle('collapsed');
      mainContent.classList.toggle('expanded');
      toggleButton.classList.toggle('collapsed');
    }
    
    // Manejo responsive del sidebar
    function handleMobileView() {
      const sidebar = document.querySelector('.sidebar');
      const toggleButton = document.querySelector('.toggle-sidebar');
      
      if (window.innerWidth <= 768) {
        sidebar.classList.add('collapsed');
        toggleButton.classList.add('collapsed');
      } else {
        sidebar.classList.remove('collapsed');
        toggleButton.classList.remove('collapsed');
      }
    }
    
    window.addEventListener('load', handleMobileView);
    window.addEventListener('resize', handleMobileView);

    // Datos para el gráfico circular de categorías más vendidas
    const categoriasData = {{ categorias_vendidas | tojson }};
    const categoriasLabels = categoriasData.map(item => item.categoria);
    const categoriasValues = categoriasData.map(item => item.ingresos_brutos);
    const ctxCategorias = document.getElementById('categoriasChart').getContext('2d');
    new Chart(ctxCategorias, {
        type: 'pie',
        data: {
            labels: categoriasLabels,
            datasets: [{
                label: 'Ingresos Brutos',
                data: categoriasValues,
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'],
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: 'Categorías Más Vendidas'
                }
            }
        }
    });

    // Datos para el gráfico de barras de ventas por día
    const ventasDiaData = {
        labels: ['Ingresos Brutos', 'Ganancias Totales'],
        datasets: [{
            label: 'Ingresos Brutos',
            data: [{{ ventas_dia }}, {{ ganancias_dia }}],
            backgroundColor: ['#36A2EB', '#FF6384']
        }]
    };
    const ctxVentasDia = document.getElementById('ventasDiaChart').getContext('2d');
    new Chart(ctxVentasDia, {
        type: 'bar',
        data: ventasDiaData,
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: 'Ventas por Día'
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // Datos para el gráfico circular de ventas por método de pago
    const metodoPagoData = {{ ventas_metodo_pago | tojson }};
    const metodoPagoLabels = metodoPagoData.map(item => item.metodo_pago);
    const metodoPagoValues = metodoPagoData.map(item => item.ganancia_total);
    const ctxMetodoPago = document.getElementById('metodoPagoChart').getContext('2d');
    new Chart(ctxMetodoPago, {
        type: 'pie',
        data: {
            labels: metodoPagoLabels,
            datasets: [{
                label: 'Ganancias por Método de Pago',
                data: metodoPagoValues,
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'],
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: 'Ventas por Método de Pago'
                }
            }
        }
    });
</script>
</body>
</html>