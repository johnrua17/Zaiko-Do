<div class="barcode-entry">
    <label for="codigo_barras">Buscar producto:</label>
    <input type="text" id="codigo_barras" name="codigo_barras" placeholder="Código de barras, nombre o categoría">
    <button id="buscar_producto">Buscar</button>
</div>
<script>
    document.getElementById('buscar_producto').addEventListener('click', async () => {
        const terminoBusqueda = document.getElementById('codigo_barras').value;

        if (!terminoBusqueda) {
            alert('Por favor, ingresa un término de búsqueda.');
            return;
        }

        try {
            const response = await fetch('/buscar_productos', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ termino_busqueda: terminoBusqueda }),
            });

            if (!response.ok) throw new Error('Error al buscar productos');

            const data = await response.json();

            if (data.error) {
                alert(data.error);
                return;
            }

            const tablaProductos = document.getElementById('tabla_productos');
            tablaProductos.innerHTML = ''; // Limpiar tabla antes de agregar nuevos resultados

            data.productos.forEach((producto) => {
                const fila = `
                    <tr>
                        <td>${producto.Codigo_de_barras}</td>
                        <td>${producto.Nombre}</td>
                        <td>${producto.Descripcion}</td>
                        <td>${producto.Precio_Valor}</td>
                        <td>${producto.Cantidad}</td>
                        <td>${producto.Categoria}</td>
                    </tr>
                `;
                tablaProductos.insertAdjacentHTML('beforeend', fila);
            });
        } catch (error) {
            console.error(error);
            alert('Ocurrió un error al buscar los productos.');
        }
    });
</script>