<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Zaiko Do </title>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/static/styles.css">
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <style>
           /* Estilo general para los botones del modal */
#downloadModal .btn-download {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    margin: 10px 0;
    padding: 10px;
    font-size: 14px;
    font-weight: bold;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s;
}

#downloadModal .btn-download .icon {
    margin-right: 8px;
    font-size: 18px;
}

/* Bot√≥n Excel */
#downloadModal .btn-download.excel {
    background-color: #28a745;
    color: white;
}
#downloadModal .btn-download.excel:hover {
    background-color: #218838;
    transform: scale(1.05);
}

/* Bot√≥n PDF */
#downloadModal .btn-download.pdf {
    background-color: #28a745;
    color: white;
}
#downloadModal .btn-download.pdf:hover {
    background-color: #218838;
    transform: scale(1.05);
}

/* Bot√≥n Cancelar */
#downloadModal .btn-download.cancel {
    background-color: #6c757d;
    color: white;
}
#downloadModal .btn-download.cancel:hover {
    background-color: #5a6268;
    transform: scale(1.05);
}

/* Sombra en los botones al hacer clic */
#downloadModal .btn-download:active {
    box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.2);
}

        </style>
        <style>
            /* Espaciado y alineaci√≥n para los elementos de la barra de b√∫squeda */




            .barcode-entry {
                display: flex;
                align-items: center;
                justify-content: flex-start;
                gap: 15px; /* Espaciado entre el input y el bot√≥n */
                margin: 20px; /* Espaciado general alrededor del contenedor */
                padding: 10px; /* Espaciado interno dentro del contenedor */
                background-color: #f9f9f9; /* Fondo claro para mayor claridad visual */
                border-radius: 8px; /* Bordes redondeados */
            }
        
            /* Contenedor principal para asegurar m√°rgenes */
            .main-content {
                padding: 10px; /* Espaciado interno para evitar bordes pegados */
            }
        
            /* Bot√≥n verde */
            .data-table button,
            .barcode-entry .buscar-btn,
            .download-btn {
                padding: 10px 15px;
                font-size: 14px;
                background-color: #4caf83 !important; /* Verde */
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                transition: background-color 0.3s ease;
                width: auto; /* Asegura que el ancho sea ajustado autom√°ticamente */
            }
        
            .data-table button:hover,
            .barcode-entry .buscar-btn:hover,
            .download-btn:hover {
                background-color: #388e3c !important; /* Un tono m√°s oscuro del verde */
            }
        
            /* Ajuste de espaciado vertical entre botones */
            .data-table .btn-edit {
                margin-bottom: 10px; /* Espacio inferior para separar del siguiente bot√≥n */
            }
        
            /* Elimina estilos redundantes del bot√≥n de descarga */
            .download-btn {
                position: static; /* Ajustamos para evitar conflictos */
                display: inline-block; /* Evita comportamientos inesperados */
            }
        </style>
    </head>
    <body>
        <button class="toggle-sidebar" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
        {% include 'sidebar.html' %}
        <div class="main-content">
            <div class="table-container">
                <!-- Reemplaza la barra de b√∫squeda con la inclusi√≥n de la plantilla -->
                {% include 'buscar_productos.html' %}
                <div class="barcode-entry">
                    <!-- Bot√≥n para mostrar la ventana modal -->
                    <button type="button" class="data-table download-btn" title="Descargar Productos" onclick="openDownloadModal()">
                        <i class="fas fa-download"></i> Descargar productos
             ¬†¬†¬†¬†¬†¬†¬†</button>
                
                    <!-- Ventana modal -->
                    <div id="downloadModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:white; border:1px solid #ccc; padding:20px; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,0.1); width:300px; text-align:center;">
                        <p style="font-weight: normal; font-size:16px; margin-bottom:20px;">Seleccione el formato de descarga</p>
                        <button class="btn-download excel" onclick="submitDownload('xlsx')">
                            <span class="icon">üìä</span> Descargar como Excel
                        </button>
                        <button class="btn-download pdf" onclick="submitDownload('pdf')">
                            <span class="icon">üìÑ</span> Descargar como PDF
                        </button>
                        <button class="btn-download cancel" onclick="closeDownloadModal()">
                            <span class="icon">‚ùå</span> Cancelar
                        </button>
                    </div>
                    
                </div>          
                <div class="table-header"> 
                    <h2>Productos</h2>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>C√≥digo</th>
                            <th>Producto</th>
                            <th>Descripci√≥n</th>
                            <th>Precio</th>
                            <th>Stock</th>
                            <th>Categor√≠a</th>
                            <th>Opciones</th>
                        </tr>
                    </thead>
                    <tbody id="tabla_productos">
                        {% for producto in productos %}
                        <tr>
                            <td>{{ producto.Codigo_de_barras }}</td>
                            <td>{{ producto.Nombre }}</td>
                            <td>{{ producto.Descripcion }}</td>
                            <td>${{ producto.Precio_Valor }}</td>
                            <td>{{ producto.Cantidad }}</td>
                            <td>{{ producto.Categoria }}</td>
                            <td>
                                <a href="/productos/editar/{{ producto.Codigo_de_barras }}">
                                    <button class="data-table btn-edit">Editar</button>
                                </a>
                                <form id="deleteForm" action="/productos/eliminar/{{ producto.Codigo_de_barras }}" method="get" class="delete-form">
                                    <button type="button" class="data-table btn-delete" id="btnDelete">Eliminar Producto</button>
                                </form>
                                
                                <script>
                                    document.getElementById('btnDelete').addEventListener('click', function (event) {
                                        Swal.fire({
                                            title: '¬øEst√°s seguro?',
                                            text: "¬°No podr√°s revertir esta acci√≥n!",
                                            icon: 'warning',
                                            showCancelButton: true,
                                            confirmButtonColor: '#3085d6',
                                            cancelButtonColor: '#d33',
                                            confirmButtonText: 'S√≠, eliminar',
                                            cancelButtonText: 'Cancelar'
                                        }).then((result) => {
                                            if (result.isConfirmed) {
                                                document.getElementById('deleteForm').submit(); // Env√≠a el formulario
                                            }
                                        });
                                    });
                                </script>
                                
                        </tr>
                        {% endfor %}
                        <!-- Productos se a√±adir√°n aqu√≠ din√°micamente -->
                    </tbody>
                </table>
            </div>
        </div>  
       
        <script>
            function toggleSubmenu(submenuId) {
                const submenu = document.getElementById(submenuId);
                const parentItem = submenu.previousElementSibling;
               
                // Cerrar todos los submen√∫s primero
                document.querySelectorAll('.submenu').forEach(menu => {
                    if (menu.id !== submenuId) {
                        menu.classList.remove('active');
                        menu.previousElementSibling.classList.remove('expanded');
                    }
                });
               
                // Alternar el submen√∫ actual
                submenu.classList.toggle('active');
                parentItem.classList.toggle('expanded');
            }
   
            // Marcar como activo el enlace actual seg√∫n la URL
            document.addEventListener('DOMContentLoaded', function() {
                const currentPath = window.location.pathname;
                document.querySelectorAll('.nav-items a').forEach(link => {
                    if (link.getAttribute('href') === currentPath) {
                        link.classList.add('active');
                        // Si es un submen√∫, expandir el padre
                        if (link.classList.contains('submenu-item')) {
                            const submenu = link.parentElement;
                            submenu.classList.add('active');
                            submenu.previousElementSibling.classList.add('expanded');
                        }
                    }
                });
            });
        </script>
   
        <script>
            function toggleSidebar() {
                const sidebar = document.querySelector('.sidebar');
                const mainContent = document.querySelector('.main-content');
                const toggleButton = document.querySelector('.toggle-sidebar');
               
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('expanded');
                toggleButton.classList.toggle('collapsed');
            }
   
            // Manejo responsive
            function handleMobileView() {
                const sidebar = document.querySelector('.sidebar');
                const toggleButton = document.querySelector('.toggle-sidebar');
               
                if (window.innerWidth <= 768) {
                    sidebar.classList.add('collapsed');
                    toggleButton.classList.add('collapsed');
                } else {
                    sidebar.classList.remove('collapsed');
                    toggleButton.classList.remove('collapsed');
                }
            }
   
            window.addEventListener('load', handleMobileView);
            window.addEventListener('resize', handleMobileView);
        </script>
        <script>
            function openDownloadModal() {
    const button = document.querySelector('.download-btn');
    const modal = document.getElementById('downloadModal');

    // Obt√©n las coordenadas del bot√≥n
    const buttonRect = button.getBoundingClientRect();
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

    // Ajusta la posici√≥n del modal
    modal.style.top = `${buttonRect.bottom + scrollTop + 10}px`; // 10px debajo del bot√≥n
    modal.style.left = `${buttonRect.left + buttonRect.width / 2}px`; // Centra horizontalmente respecto al bot√≥n
    modal.style.transform = 'translateX(-25%)'; // Ajusta el modal para que est√© centrado horizontalmente
    modal.style.display = 'block';
}

function closeDownloadModal() {
    document.getElementById('downloadModal').style.display = 'none';
}

            function submitDownload(format) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/descargar_productos?format=${format}`;
                document.body.appendChild(form);
                form.submit();
            }
        </script>
</body>
</html>